import{p as x,l as C,s as v,r as E,c as _,x as h,J as H,S as L,K as q,L as k,M as A,m as t,N as D,B as U,d as $,O as J}from"./index-4af8d743.js";import{k as K,m as G,l as Q,I as X,b as Y,j as N,M as m}from"./rounded-727bd6fe.js";const Z=x({alt:String,cover:Boolean,eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},srcset:String,...K(),...G(),...Q()},"VImg"),ae=C()({name:"VImg",directives:{intersect:X},props:Z(),emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(e,W){let{emit:f,slots:s}=W;const y=v(""),n=E(),l=v(e.eager?"loading":"idle"),c=v(),d=v(),i=_(()=>e.src&&typeof e.src=="object"?{src:e.src.src,srcset:e.srcset||e.src.srcset,lazySrc:e.lazySrc||e.src.lazySrc,aspect:Number(e.aspectRatio||e.src.aspect||0)}:{src:e.src,srcset:e.srcset,lazySrc:e.lazySrc,aspect:Number(e.aspectRatio||0)}),o=_(()=>i.value.aspect||c.value/d.value||0);h(()=>e.src,()=>{S(l.value!=="idle")}),h(o,(a,r)=>{!a&&r&&n.value&&g(n.value)}),H(()=>S());function S(a){if(!(e.eager&&a)&&!(L&&!a&&!e.eager)){if(l.value="loading",i.value.lazySrc){const r=new Image;r.src=i.value.lazySrc,g(r,null)}i.value.src&&q(()=>{var r,u;if(f("loadstart",((r=n.value)==null?void 0:r.currentSrc)||i.value.src),(u=n.value)!=null&&u.complete){if(n.value.naturalWidth||I(),l.value==="error")return;o.value||g(n.value,null),z()}else o.value||g(n.value),b()})}}function z(){var a;b(),l.value="loaded",f("load",((a=n.value)==null?void 0:a.currentSrc)||i.value.src)}function I(){var a;l.value="error",f("error",((a=n.value)==null?void 0:a.currentSrc)||i.value.src)}function b(){const a=n.value;a&&(y.value=a.currentSrc||a.src)}let w=-1;function g(a){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const u=()=>{clearTimeout(w);const{naturalHeight:T,naturalWidth:V}=a;T||V?(c.value=V,d.value=T):!a.complete&&l.value==="loading"&&r!=null?w=window.setTimeout(u,r):(a.currentSrc.endsWith(".svg")||a.currentSrc.startsWith("data:image/svg+xml"))&&(c.value=1,d.value=1)};u()}const R=_(()=>({"v-img__img--cover":e.cover,"v-img__img--contain":!e.cover})),B=()=>{var u;if(!i.value.src||l.value==="idle")return null;const a=t("img",{class:["v-img__img",R.value],src:i.value.src,srcset:i.value.srcset,alt:e.alt,sizes:e.sizes,ref:n,onLoad:z,onError:I},null),r=(u=s.sources)==null?void 0:u.call(s);return t(m,{transition:e.transition,appear:!0},{default:()=>[k(r?t("picture",{class:"v-img__picture"},[r,a]):a,[[J,l.value==="loaded"]])]})},F=()=>t(m,{transition:e.transition},{default:()=>[i.value.lazySrc&&l.value!=="loaded"&&t("img",{class:["v-img__img","v-img__img--preload",R.value],src:i.value.lazySrc,alt:e.alt},null)]}),M=()=>s.placeholder?t(m,{transition:e.transition,appear:!0},{default:()=>[(l.value==="loading"||l.value==="error"&&!s.error)&&t("div",{class:"v-img__placeholder"},[s.placeholder()])]}):null,O=()=>s.error?t(m,{transition:e.transition,appear:!0},{default:()=>[l.value==="error"&&t("div",{class:"v-img__error"},[s.error()])]}):null,j=()=>e.gradient?t("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${e.gradient})`}},null):null,P=v(!1);{const a=h(o,r=>{r&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{P.value=!0})}),a())})}return Y(()=>{const[a]=N.filterProps(e);return k(t(N,U({class:["v-img",{"v-img--booting":!P.value},e.class],style:[{width:$(e.width==="auto"?c.value:e.width)},e.style]},a,{aspectRatio:o.value,"aria-label":e.alt,role:e.alt?"img":void 0}),{additional:()=>t(D,null,[t(B,null,null),t(F,null,null),t(j,null,null),t(M,null,null),t(O,null,null)]),default:s.default}),[[A("intersect"),{handler:S,options:e.options},null,{once:!0}]])}),{currentSrc:y,image:n,state:l,naturalWidth:c,naturalHeight:d}}});export{ae as V};
